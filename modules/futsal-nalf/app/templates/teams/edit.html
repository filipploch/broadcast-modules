{% extends "base/base.html" %}

{% block title %}Edytuj Zesp√≥≈Ç{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Edytuj Zesp√≥≈Ç: {{ team.name }}</h2>
        <a href="{{ url_for('view_team', team_id=team.id) }}" class="btn btn-secondary">‚Üê Powr√≥t</a>
    </div>
    
    <form method="POST">
        <div class="form-group">
            <label for="name">
                Pe≈Çna Nazwa Zespo≈Çu *
            </label>
            <input 
                type="text" 
                id="name" 
                name="name" 
                required
                maxlength="100"
                value="{{ team.name }}">
        </div>
        
        <div class="form-group">
            <label for="name_20">
                Nazwa Skr√≥cona (max 20 znak√≥w) *
            </label>
            <input 
                type="text" 
                id="name_20" 
                name="name_20" 
                maxlength="20"
                required
                value="{{ team.name_20 }}">
            <small id="name20_counter">{{ team.name_20|length }} / 20 znak√≥w</small>
        </div>
        
        <div class="form-group">
            <label for="short_name">
                Skr√≥t 3-literowy (TLA) *
            </label>
            <input 
                type="text" 
                id="short_name" 
                name="short_name" 
                minlength="3"
                maxlength="3"
                required
                value="{{ team.short_name }}"
                style="text-transform: uppercase;">
            <small>Wpisz dok≈Çadnie 3 litery (A-Z)</small>
        </div>

        <div class="form-group">
            <label for="foreign_id">
                Foreign ID
                <small style="display: inline; margin-left: 0.5rem; color: #7f8c8d;">(kliknij dwukrotnie aby edytowaƒá)</small>
            </label>
            <input
                type="text"
                id="foreign_id"
                name="foreign_id"
                value="{{ team.foreign_id or '' }}"
                maxlength="500"
                placeholder="np. external-team-999"
                readonly
                style="background: #f8f9fa; cursor: pointer;"
                ondblclick="enableElementToEdit(this)">
            <small style="color: #6c757d;">Zewnƒôtrzny identyfikator - kliknij dwukrotnie aby edytowaƒá</small>
        </div>
        
        <div class="form-group">
            <label for="team_url">
                URL Zespo≈Çu NALF *
            </label>
            <input 
                type="url" 
                id="team_url" 
                name="team_url" 
                required
                value="{{ team.team_url }}">
            <small>Unikalny URL ze strony NALF</small>
        </div>
        
        <div class="form-group">
            <label for="logo_path">
                ≈öcie≈ºka do Logo
                <small>Domy≈õlnie: static/images/logos/default.png</small>
            </label>
            <input
                type="text"
                id="logo_path"
                name="logo_path"
                value="{{ url_for('static', filename=team.logo_path.replace('static/', '')) }}"
                placeholder="static/images/logos/nazwa_zespolu.png">
            <div id="selected-logo-preview">
                <img src="{{ url_for('static', filename=team.logo_path.replace('static/', '')) }}"
                     alt="{{ team.name }}"
                     style="max-height: 100px; max-width: 100px; object-fit: contain;">
            </div>
            <button type="button" onclick="openModal('logos-container')">Wybierz logo</button>

            <small>
                üí° Mo≈ºesz p√≥≈∫niej zmieniƒá logo w edycji zespo≈Çu.
                Logo powinno byƒá umieszczone w katalogu static/images/logos/
            </small>
        </div>

        <div class="actions">
            <button type="submit" class="btn btn-success">üíæ Zapisz Zmiany</button>
            <a href="{{ url_for('view_team', team_id=team.id) }}" class="btn btn-secondary">Anuluj</a>
        </div>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h2>Informacje Systemowe</h2>
    </div>
    
    <table>
        <tr>
            <td style="width: 30%; font-weight: 600;">ID Zespo≈Çu:</td>
            <td>{{ team.id }}</td>
        </tr>
        <tr>
            <td style="font-weight: 600;">Data utworzenia:</td>
            <td>{{ team.created_at.strftime('%Y-%m-%d %H:%M') if team.created_at else 'N/A' }}</td>
        </tr>
        <tr>
            <td style="font-weight: 600;">Ostatnia aktualizacja:</td>
            <td>{{ team.updated_at.strftime('%Y-%m-%d %H:%M') if team.updated_at else 'N/A' }}</td>
        </tr>
    </table>
</div>
{% endblock %}

{% block modal_content %}
    <div id="logos-container" class="modal-content nodisplayed">
        {% if logos %}
            {% for logo in logos %}
                <div class="logo-option">
                    <input type="radio" class="invisible" id="logo-{{ loop.index }}" name="selected-logo" value="{{ logo.path[1:] }}">
                    <label for="logo-{{ loop.index }}">
                        <img src="{{ url_for('static', filename=logo.path[8:]) }}"
                             alt="{{ logo.filename[:-4] }}"
                             ondblclick="getSelectedLogo();"
                             class="logo-image">
                        <br>
                        {{ logo.filename[:-4] }}
                    </label>
                </div>
            {% endfor %}
        {% else %}
            <p>Brak dostƒôpnych logo w folderze.</p>
        {% endif %}
    </div>
{% endblock %}

{% block extra_js %}
<script>
    
    // Character counter for name_20
    document.getElementById('name_20').addEventListener('input', function() {
        const value = this.value;
        document.getElementById('name20_counter').textContent = value.length + ' / 20 znak√≥w';
    });
    
    // Auto-uppercase for short_name
    document.getElementById('short_name').addEventListener('input', function() {
        this.value = this.value.toUpperCase();
    });
    
    // Logo preview update
    document.getElementById('logo_path').addEventListener('input', function() {
        const logoPreview = document.getElementById('logo_preview');
        const path = this.value.replace('static/', '');
        logoPreview.src = '{{ url_for('static', filename='') }}' + path;
    });

    function extractForeignId() {
        const foreignIdInput = document.getElementById('foreign_id');
        
        // Only update if field is readonly (not manually edited)
        if (foreignIdInput.hasAttribute('readonly')) {
            const foreignId = teamUrl.split('sp_team=')[1];
            foreignIdInput.value = foreignId;
            foreignIdInput.style.background = '#d4edda';
        }
    }
</script>
{% endblock %}
