{% extends "base/base.html" %}

{% block title %}Uzupe≈Çnij Dane Zespo≈Çu{% endblock %}

{% block extra_css %}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Uzupe≈Çnij Dane Zespo≈Çu</h2>
    </div>
    
    <div style="background: #e7f3ff; border: 1px solid #b3d9ff; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem;">
        <strong>üìã Dane ze scrapowania:</strong>
        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
            <li><strong>Nazwa:</strong> {{ team.name }}</li>
            <li><strong>URL:</strong> <a href="{{ team.team_url }}" target="_blank" style="color: #3498db;">{{ team.team_url }}</a></li>
        </ul>
    </div>
    
    <form method="POST">
        <div class="form-group">
            <label for="name">
                Pe≈Çna Nazwa Zespo≈Çu
                <small>Ta warto≈õƒá zosta≈Ça pobrana ze scrapowania</small>
            </label>
            <input 
                type="text" 
                id="name" 
                name="name" 
                value="{{ team.name }}" 
                readonly
                style="background: #f5f5f5; cursor: not-allowed;">
        </div>
        
        <div class="form-group">
            <label for="name_20">
                Nazwa Skr√≥cona (max 20 znak√≥w) *
                <small>Kr√≥tka nazwa do wy≈õwietlania w tabelach i raportach</small>
            </label>
            <input 
                type="text" 
                id="name_20" 
                name="name_20" 
                maxlength="20"
                required
                placeholder="np. {{ team.name[:20] }}"
                value="{{ team.name[:20] }}">
            <small id="name20_counter">0 / 20 znak√≥w</small>
        </div>
        
        <div class="form-group">
            <label for="short_name">
                Skr√≥t 3-literowy (TLA) *
                <small>Trzyliterowy kod zespo≈Çu (np. KRA, WAR, POZ)</small>
            </label>
            <input 
                type="text" 
                id="short_name" 
                name="short_name"
                minlength="3"
                maxlength="3"
                required
                placeholder="np. {{ team.name[:3]|upper }}"
                value="{{ team.name[:3]|upper }}"
                style="text-transform: uppercase;">
            <small>Wpisz dok≈Çadnie 3 litery (A-Z)</small>
        </div>
        
        <div class="form-group">
            <label for="foreign_id">
                Foreign ID
                <small style="display: inline; margin-left: 0.5rem; color: #7f8c8d;">(kliknij dwukrotnie aby edytowaƒá)</small>
            </label>
            <input
                type="text"
                id="foreign_id"
                name="foreign_id"
                value="{{ team.foreign_id or '' }}"
                maxlength="500"
                placeholder="np. external-team-999"
                readonly
                style="background: #f8f9fa; cursor: pointer;"
                ondblclick="enableForeignIdComplete(this)">
            <small style="color: #6c757d;">Zewnƒôtrzny identyfikator - kliknij dwukrotnie aby edytowaƒá</small>
        </div>

        <div class="form-group">
            <label for="logo_path">
                ≈öcie≈ºka do Logo
                <small>Domy≈õlnie: static/images/logos/default.png</small>
            </label>
            <input
                type="text"
                id="logo_path"
                name="logo_path"
                value="static/images/logos/default.png"
                placeholder="static/images/logos/nazwa_zespolu.png">
            <div id="selected-logo-preview">
                <img src="/static/images/logos/default.png" alt="Domy≈õlne logo" style="max-width: 200px;">
            </div>
            <button type="button" onclick="openModal('logos-container')">Wybierz logo</button>

            <small>
                üí° Mo≈ºesz p√≥≈∫niej zmieniƒá logo w edycji zespo≈Çu.
                Logo powinno byƒá umieszczone w katalogu static/images/logos/
            </small>
        </div>

        <div class="form-group">
            <label>
                PodglƒÖd
            </label>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; border: 1px solid #e0e0e0;">
                <table style="width: 100%;">
                    <tr>
                        <td style="width: 30%; font-weight: 600;">Skr√≥t:</td>
                        <td><span id="preview_short_name" style="font-weight: bold; color: #2c3e50;">---</span></td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">Nazwa 20:</td>
                        <td><span id="preview_name_20" style="color: #2c3e50;">---</span></td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">Pe≈Çna nazwa:</td>
                        <td>{{ team.name }}</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="actions">
            <button type="submit" class="btn btn-success">‚úÖ Dodaj Zesp√≥≈Ç do Bazy</button>
            <a href="{{ url_for('pending_teams') }}" class="btn btn-secondary">Powr√≥t do Listy</a>
        </div>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h2>üí° Wskaz√≥wki</h2>
    </div>
    
    <ul style="margin-left: 1.5rem; line-height: 2;">
        <li><strong>Nazwa 20:</strong> U≈ºywana w raportach i tabelach gdzie brakuje miejsca na pe≈ÇnƒÖ nazwƒô</li>
        <li><strong>Skr√≥t 3-literowy:</strong> Unikalny kod zespo≈Çu (TLA - Three Letter Acronym)</li>
        <li><strong>Logo:</strong> Mo≈ºesz u≈ºyƒá domy≈õlnego logo i zmieniƒá je p√≥≈∫niej podczas edycji</li>
    </ul>
</div>
{% endblock %}

{% block modal_content %}
    <div id="logos-container" class="modal-content nodisplayed">
        {% if logos %}
            {% for logo in logos %}
                <div class="logo-option">
                    <input type="radio" class="invisible" id="logo-{{ loop.index }}" name="selected-logo" value="{{ logo.path[1:] }}">
                    <label for="logo-{{ loop.index }}">
                        <img src="{{ url_for('static', filename=logo.path[8:]) }}"
                             alt="{{ logo.filename[:-4] }}"
                             ondblclick="getSelectedLogo();"
                             class="logo-image">
                        <br>
                        {{ logo.filename[:-4] }}
                    </label>
                </div>
            {% endfor %}
        {% else %}
            <p>Brak dostƒôpnych logo w folderze.</p>
        {% endif %}
    </div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const teamUrl = "{{ team.team_url }}";
        if (teamUrl && teamUrl.includes('sp_team=')) {
            const foreignId = teamUrl.split('sp_team=')[1];
            foreignIdInput = document.getElementById('foreign_id')
            foreignIdInput.value = foreignId;
            foreignIdInput.setAttribute('readonly', 'readonly');
            foreignIdInput.style.background = '#f8f9fa';
            foreignIdInput.style.cursor = 'pointer';
        }
    });

    function enableForeignIdComplete(input) {
        input.removeAttribute('readonly');
        input.style.background = '#fff';
        input.style.cursor = 'text';
        input.focus();
        input.select();
        
        input.onblur = function() {
            this.setAttribute('readonly', 'readonly');
            this.style.background = '#f8f9fa';
            this.style.cursor = 'pointer';
        };
    }
    // Live preview
    document.getElementById('name_20').addEventListener('input', function() {
        const value = this.value;
        document.getElementById('preview_name_20').textContent = value || '---';
        document.getElementById('name20_counter').textContent = value.length + ' / 20 znak√≥w';
    });
    
    document.getElementById('short_name').addEventListener('input', function() {
        this.value = this.value.toUpperCase();
        document.getElementById('preview_short_name').textContent = this.value || '---';
    });
    
    // Initialize preview
    document.getElementById('name_20').dispatchEvent(new Event('input'));
    document.getElementById('short_name').dispatchEvent(new Event('input'));
</script>
{% endblock %}
